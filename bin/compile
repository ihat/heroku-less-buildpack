#!/usr/bin/env bash
set -eo pipefail

BUILD_DIR=$1
CACHE_DIR=$2
VENDOR_DIR="$BUILD_DIR/vendor"

echo 'BUILD_DIR compile' $BUILD_DIR
echo 'CACHE_DIR compile' $CACHE_DIR
echo 'VENDOR_DIR compile' $VENDOR_DIR

# Work around Heroku bug whereby pylibmc isn't available during
# compile phase. See: https://github.com/heroku/heroku-buildpack-python/issues/57
export MEMCACHE_SERVERS='' MEMCACHIER_SERVERS=''

if [ -f bin/install_nodejs ]; then
    echo "-----> Running install_nodejs"
    chmod +x bin/install_nodejs
    bin/install_nodejs

    if [ -f bin/install_less ]; then
        echo "-----> Running install_lessc"
        chmod +x bin/install_less
        bin/install_less
    fi
fi
